language: cpp
sudo: true

services:
  - docker

matrix:
  include:
    - env: BUILD_TYPE=deb DEBIAN_VERSION=stretch
    - env: BUILD_TYPE=deb DEBIAN_VERSION=buster
    - env: BUILD_TYPE=deb DEBIAN_VERSION=stretch CROSS=raspberry-pi
    - env: BUILD_TYPE=python PYTHON_VERSION=3.5 DEBIAN_VERSION=stretch BUILDER_SDIST=true
    - env: BUILD_TYPE=python PYTHON_VERSION=3.5 DEBIAN_VERSION=stretch CROSS=raspberry-pi BUILDER_WHEEL=true
    - env: BUILD_TYPE=python PYTHON_VERSION=3.6 DEBIAN_VERSION=stretch CROSS=raspberry-pi BUILDER_WHEEL=true
    - env: BUILD_TYPE=python PYTHON_VERSION=3.7 DEBIAN_VERSION=stretch CROSS=raspberry-pi BUILDER_WHEEL=true

install:
  - ci/scripts/install.sh

script:
  - ci/scripts/script.sh

after_success:
  - ci/scripts/after_success.sh

before_deploy:
  - cd ${TRAVIS_BUILD_DIR}

deploy:
- provider: pypi
  user: "${PYPI_USERNAME}"
  password: "${PYPI_PASSWORD}"
  on:
    tags: true
- provider: releases
  api_key: $GITHUB_OAUTH_TOKEN
  skip_cleanup: true
  file_glob: true
  file: 'src/build/dist/*'
  on:
    tags: true
